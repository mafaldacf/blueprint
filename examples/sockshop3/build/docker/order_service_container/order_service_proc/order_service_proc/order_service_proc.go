// Package main is auto-generated by gogen/namespacebuilder.go
//
// It provides funcs for instantiating the order_service_proc namespace.
//
// To instantiate the order_service_proc namespace, first call [New_order_service_proc] and then either call 
// [Build] or [BuildWithParent].
// 
// See [golang.NamespaceBuilder] docs for more information about the behavior of [Build]
package main

import (
	"github.com/blueprint-uservices/blueprint/runtime/core/backend"
	"github.com/blueprint-uservices/blueprint/runtime/plugins/golang"
	"github.com/blueprint-uservices/blueprint/runtime/plugins/opentelemetry"
	"github.com/blueprint-uservices/blueprint/runtime/plugins/slogger"
	"blueprint/goproc/order_service_proc/thrift"
	"github.com/blueprint-uservices/blueprint/examples/sockshop3/workflow/sockshop3"
	"github.com/blueprint-uservices/blueprint/runtime/plugins/mongodb"
)

// Initializes the order_service_proc namespace by defining all of the nodes that run
// within the namespace.
//
// [Build] or [BuildWithParent] must be called on the return value of this func
// to actually build and run the nodes in the namespace.
func New_order_service_proc(name string) *golang.NamespaceBuilder {
	b := golang.NewNamespaceBuilder(name)
	set_order_service_proc_Args(b)
	set_order_service_proc_Instances(b)
	set_order_service_proc_Definitions(b)
	return b
}

// order_service_proc requires that its arguments are either:
//  - explicitly set with [golang.NamespaceBuilder.Set]
//  - passed on the command line (if built using [golang.NamespaceBuilder.Build])
//  - are defined in parent (if built using [golang.NamespaceBuilder.BuildWithParent])
//
// The following arguments will be eagerly checked and building the namespace
// will fail if they haven't been provided:
//   cart_service.thrift.dial_addr
//   order_db.dial_addr
//   order_service.thrift.bind_addr
//   payment_service.thrift.dial_addr
//   shipping_service.thrift.dial_addr
//   user_service.thrift.dial_addr
//
// The following arguments are optional and a failure will only occur if the client
// tries to build a node that needs the argument to be set
func set_order_service_proc_Args(b *golang.NamespaceBuilder) {
	b.Required("cart_service.thrift.dial_addr", "Argument generated by Blueprint IR: cart_service.thrift.dial_addr = AddressConfig()")
	b.Required("order_db.dial_addr", "Argument generated by Blueprint IR: order_db.dial_addr = AddressConfig()")
	b.Required("order_service.thrift.bind_addr", "Argument generated by Blueprint IR: order_service.thrift.bind_addr = AddressConfig()")
	b.Required("payment_service.thrift.dial_addr", "Argument generated by Blueprint IR: payment_service.thrift.dial_addr = AddressConfig()")
	b.Required("shipping_service.thrift.dial_addr", "Argument generated by Blueprint IR: shipping_service.thrift.dial_addr = AddressConfig()")
	b.Required("user_service.thrift.dial_addr", "Argument generated by Blueprint IR: user_service.thrift.dial_addr = AddressConfig()")
}

// When the order_service_proc namespace is built it will automatically instantiate
// the following nodes:
//   order_service_proc.stdoutmetriccollector
//   order_service_proc.logger
//   user_service.thrift_client
//   user_service.client
//   cart_service.thrift_client
//   cart_service.client
//   payment_service.thrift_client
//   payment_service.client
//   shipping_service.thrift_client
//   shipping_service.client
//   order_db.client
//   order_service
//   order_service.thrift_server
func set_order_service_proc_Instances(b *golang.NamespaceBuilder) {
	b.Instantiate("order_service_proc.stdoutmetriccollector")
	b.Instantiate("order_service_proc.logger")
	b.Instantiate("user_service.thrift_client")
	b.Instantiate("user_service.client")
	b.Instantiate("cart_service.thrift_client")
	b.Instantiate("cart_service.client")
	b.Instantiate("payment_service.thrift_client")
	b.Instantiate("payment_service.client")
	b.Instantiate("shipping_service.thrift_client")
	b.Instantiate("shipping_service.client")
	b.Instantiate("order_db.client")
	b.Instantiate("order_service")
	b.Instantiate("order_service.thrift_server")
}

// The order_service_proc namespace contains definitions for instantiating
// the following nodes:
//   cart_service.client
//   cart_service.thrift_client
//   order_db.client
//   order_service
//   order_service.thrift_server
//   order_service_proc.logger
//   order_service_proc.stdoutmetriccollector
//   payment_service.client
//   payment_service.thrift_client
//   shipping_service.client
//   shipping_service.thrift_client
//   user_service.client
//   user_service.thrift_client
func set_order_service_proc_Definitions(b *golang.NamespaceBuilder) {
	b.Define("cart_service.client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin workflow/ir_workflowservice.go
		var client sockshop3.CartService
		err := n.Get("cart_service.thrift_client", &client)
		return client, err
	})
	
	b.Define("cart_service.thrift_client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var addr string
		if err := n.Get("cart_service.thrift.dial_addr", &addr); err != nil {
			return nil, err
		}
		
		return thrift.New_CartService_ThriftClient(n.Context(), addr)
	})
	
	b.Define("order_db.client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var addr string
		if err := n.Get("order_db.dial_addr", &addr); err != nil {
			return nil, err
		}
		
		return mongodb.NewMongoDB(n.Context(), addr)
	})
	
	b.Define("order_service", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var userService sockshop3.UserService
		if err := n.Get("user_service.client", &userService); err != nil {
			return nil, err
		}
		
		var cartService sockshop3.CartService
		if err := n.Get("cart_service.client", &cartService); err != nil {
			return nil, err
		}
		
		var payments sockshop3.PaymentService
		if err := n.Get("payment_service.client", &payments); err != nil {
			return nil, err
		}
		
		var shipping sockshop3.ShippingService
		if err := n.Get("shipping_service.client", &shipping); err != nil {
			return nil, err
		}
		
		var orderDB backend.NoSQLDatabase
		if err := n.Get("order_db.client", &orderDB); err != nil {
			return nil, err
		}
		
		return sockshop3.NewOrderService(n.Context(), userService, cartService, payments, shipping, orderDB)
	})
	
	b.Define("order_service.thrift_server", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var service sockshop3.OrderService
		if err := n.Get("order_service", &service); err != nil {
			return nil, err
		}
		
		var serverAddr string
		if err := n.Get("order_service.thrift.bind_addr", &serverAddr); err != nil {
			return nil, err
		}
		
		return thrift.New_OrderService_ThriftServerHandler(n.Context(), service, serverAddr)
	})
	
	b.Define("order_service_proc.logger", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		return slogger.NewSLogger(n.Context())
	})
	
	b.Define("order_service_proc.stdoutmetriccollector", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		return opentelemetry.NewStdoutMetricCollector(n.Context())
	})
	
	b.Define("payment_service.client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin workflow/ir_workflowservice.go
		var client sockshop3.PaymentService
		err := n.Get("payment_service.thrift_client", &client)
		return client, err
	})
	
	b.Define("payment_service.thrift_client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var addr string
		if err := n.Get("payment_service.thrift.dial_addr", &addr); err != nil {
			return nil, err
		}
		
		return thrift.New_PaymentService_ThriftClient(n.Context(), addr)
	})
	
	b.Define("shipping_service.client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin workflow/ir_workflowservice.go
		var client sockshop3.ShippingService
		err := n.Get("shipping_service.thrift_client", &client)
		return client, err
	})
	
	b.Define("shipping_service.thrift_client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var addr string
		if err := n.Get("shipping_service.thrift.dial_addr", &addr); err != nil {
			return nil, err
		}
		
		return thrift.New_ShippingService_ThriftClient(n.Context(), addr)
	})
	
	b.Define("user_service.client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin workflow/ir_workflowservice.go
		var client sockshop3.UserService
		err := n.Get("user_service.thrift_client", &client)
		return client, err
	})
	
	b.Define("user_service.thrift_client", func(n *golang.Namespace) (any, error) {
		// Auto-generated by the golang plugin gogen/namespacebuilder.go
		var addr string
		if err := n.Get("user_service.thrift.dial_addr", &addr); err != nil {
			return nil, err
		}
		
		return thrift.New_UserService_ThriftClient(n.Context(), addr)
	})
	
}
