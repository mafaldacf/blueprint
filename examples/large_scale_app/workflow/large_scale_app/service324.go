// Code generated by gen_workflow.go
package large_scale_app

import (
	"context"

	"github.com/blueprint-uservices/blueprint/runtime/core/backend"
	"go.mongodb.org/mongo-driver/bson"
)

type Service324Data struct {
	ID   string `bson:"id"`
	Data string `bson:"data"`
	DataTwo string `bson:"datatwo"`
	DataOther string `bson:"data_other"`
	DataOtherTwo string `bson:"datatwo_other"`
	DataOtherOther string `bson:"data_other_other"`
	DataOtherOtherTwo string `bson:"datatwo_other_other"`
}

type Service324 interface {
	Method324(ctx context.Context, id string, data string, datatwo string) (Service324Data, error)
	MethodOther324(ctx context.Context, id string, data string, datatwo string) (Service324Data, error)
	MethodOtherOther324(ctx context.Context, id string, data string, datatwo string) (Service324Data, error)
}

type Service324Impl struct {
	service324DB backend.NoSQLDatabase
	service325 Service325
}

func NewService324Impl(ctx context.Context, service324DB backend.NoSQLDatabase, service325 Service325) (Service324, error) {
	return &Service324Impl{
		service324DB: service324DB,
		service325: service325,
	}, nil
}

func (s *Service324Impl) Method324(ctx context.Context, id324 string, data324 string, datatwo324 string) (Service324Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id324},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service324Data{}, err
	}
	var service324Data Service324Data
	exists, err := res.One(ctx, &service324Data)
	if err != nil {
		return Service324Data{}, err
	}
	if exists {
		return service324Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	service324Data = Service324Data{
		ID:   id324,
		Data: data324,
	}
	if err := coll.InsertOne(ctx, service324Data); err != nil {
		return Service324Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	service324Data = Service324Data{
		ID:   id324,
		DataTwo: datatwo324,
	}
	if err := coll.InsertOne(ctx, service324Data); err != nil {
		return Service324Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service325.Method325(ctx, id324, data324, datatwo324); err != nil {
		return Service324Data{}, err
	}

	return service324Data, nil
}

func (s *Service324Impl) MethodOther324(ctx context.Context, id324 string, data324 string, datatwo324 string) (Service324Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id324},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service324Data{}, err
	}
	var service324Data Service324Data
	exists, err := res.One(ctx, &service324Data)
	if err != nil {
		return Service324Data{}, err
	}
	if exists {
		return service324Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	service324Data = Service324Data{
		ID:   id324,
		DataOther: data324,
	}
	if err := coll.InsertOne(ctx, service324Data); err != nil {
		return Service324Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	service324Data = Service324Data{
		ID:   id324,
		DataOtherTwo: datatwo324,
	}
	if err := coll.InsertOne(ctx, service324Data); err != nil {
		return Service324Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service325.MethodOther325(ctx, id324, data324, datatwo324); err != nil {
		return Service324Data{}, err
	}

	return service324Data, nil
}

func (s *Service324Impl) MethodOtherOther324(ctx context.Context, id324 string, data324 string, datatwo324 string) (Service324Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id324},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service324Data{}, err
	}
	var service324Data Service324Data
	exists, err := res.One(ctx, &service324Data)
	if err != nil {
		return Service324Data{}, err
	}
	if exists {
		return service324Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	service324Data = Service324Data{
		ID:   id324,
		DataOtherOther: data324,
	}
	if err := coll.InsertOne(ctx, service324Data); err != nil {
		return Service324Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service324DB.GetCollection(ctx, "service324_db", "service324_data")
	if err != nil {
		return Service324Data{}, err
	}
	service324Data = Service324Data{
		ID:   id324,
		DataOtherOtherTwo: datatwo324,
	}
	if err := coll.InsertOne(ctx, service324Data); err != nil {
		return Service324Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service325.MethodOtherOther325(ctx, id324, data324, datatwo324); err != nil {
		return Service324Data{}, err
	}

	return service324Data, nil
}
