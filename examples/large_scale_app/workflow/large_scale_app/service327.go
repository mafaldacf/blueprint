// Code generated by gen_workflow.go
package large_scale_app

import (
	"context"

	"github.com/blueprint-uservices/blueprint/runtime/core/backend"
	"go.mongodb.org/mongo-driver/bson"
)

type Service327Data struct {
	ID   string `bson:"id"`
	Data string `bson:"data"`
	DataTwo string `bson:"datatwo"`
	DataOther string `bson:"data_other"`
	DataOtherTwo string `bson:"datatwo_other"`
	DataOtherOther string `bson:"data_other_other"`
	DataOtherOtherTwo string `bson:"datatwo_other_other"`
}

type Service327 interface {
	Method327(ctx context.Context, id string, data string, datatwo string) (Service327Data, error)
	MethodOther327(ctx context.Context, id string, data string, datatwo string) (Service327Data, error)
	MethodOtherOther327(ctx context.Context, id string, data string, datatwo string) (Service327Data, error)
}

type Service327Impl struct {
	service327DB backend.NoSQLDatabase
	service328 Service328
}

func NewService327Impl(ctx context.Context, service327DB backend.NoSQLDatabase, service328 Service328) (Service327, error) {
	return &Service327Impl{
		service327DB: service327DB,
		service328: service328,
	}, nil
}

func (s *Service327Impl) Method327(ctx context.Context, id327 string, data327 string, datatwo327 string) (Service327Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id327},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service327Data{}, err
	}
	var service327Data Service327Data
	exists, err := res.One(ctx, &service327Data)
	if err != nil {
		return Service327Data{}, err
	}
	if exists {
		return service327Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	service327Data = Service327Data{
		ID:   id327,
		Data: data327,
	}
	if err := coll.InsertOne(ctx, service327Data); err != nil {
		return Service327Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	service327Data = Service327Data{
		ID:   id327,
		DataTwo: datatwo327,
	}
	if err := coll.InsertOne(ctx, service327Data); err != nil {
		return Service327Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service328.Method328(ctx, id327, data327, datatwo327); err != nil {
		return Service327Data{}, err
	}

	return service327Data, nil
}

func (s *Service327Impl) MethodOther327(ctx context.Context, id327 string, data327 string, datatwo327 string) (Service327Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id327},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service327Data{}, err
	}
	var service327Data Service327Data
	exists, err := res.One(ctx, &service327Data)
	if err != nil {
		return Service327Data{}, err
	}
	if exists {
		return service327Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	service327Data = Service327Data{
		ID:   id327,
		DataOther: data327,
	}
	if err := coll.InsertOne(ctx, service327Data); err != nil {
		return Service327Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	service327Data = Service327Data{
		ID:   id327,
		DataOtherTwo: datatwo327,
	}
	if err := coll.InsertOne(ctx, service327Data); err != nil {
		return Service327Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service328.MethodOther328(ctx, id327, data327, datatwo327); err != nil {
		return Service327Data{}, err
	}

	return service327Data, nil
}

func (s *Service327Impl) MethodOtherOther327(ctx context.Context, id327 string, data327 string, datatwo327 string) (Service327Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id327},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service327Data{}, err
	}
	var service327Data Service327Data
	exists, err := res.One(ctx, &service327Data)
	if err != nil {
		return Service327Data{}, err
	}
	if exists {
		return service327Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	service327Data = Service327Data{
		ID:   id327,
		DataOtherOther: data327,
	}
	if err := coll.InsertOne(ctx, service327Data); err != nil {
		return Service327Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service327DB.GetCollection(ctx, "service327_db", "service327_data")
	if err != nil {
		return Service327Data{}, err
	}
	service327Data = Service327Data{
		ID:   id327,
		DataOtherOtherTwo: datatwo327,
	}
	if err := coll.InsertOne(ctx, service327Data); err != nil {
		return Service327Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service328.MethodOtherOther328(ctx, id327, data327, datatwo327); err != nil {
		return Service327Data{}, err
	}

	return service327Data, nil
}
