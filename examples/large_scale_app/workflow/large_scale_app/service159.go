// Code generated by gen_workflow.go
package large_scale_app

import (
	"context"

	"github.com/blueprint-uservices/blueprint/runtime/core/backend"
	"go.mongodb.org/mongo-driver/bson"
)

type Service159Data struct {
	ID   string `bson:"id"`
	Data string `bson:"data"`
	DataTwo string `bson:"datatwo"`
	DataOther string `bson:"data_other"`
	DataOtherTwo string `bson:"datatwo_other"`
	DataOtherOther string `bson:"data_other_other"`
	DataOtherOtherTwo string `bson:"datatwo_other_other"`
}

type Service159 interface {
	Method159(ctx context.Context, id string, data string, datatwo string) (Service159Data, error)
	MethodOther159(ctx context.Context, id string, data string, datatwo string) (Service159Data, error)
	MethodOtherOther159(ctx context.Context, id string, data string, datatwo string) (Service159Data, error)
}

type Service159Impl struct {
	service159DB backend.NoSQLDatabase
	service160 Service160
}

func NewService159Impl(ctx context.Context, service159DB backend.NoSQLDatabase, service160 Service160) (Service159, error) {
	return &Service159Impl{
		service159DB: service159DB,
		service160: service160,
	}, nil
}

func (s *Service159Impl) Method159(ctx context.Context, id159 string, data159 string, datatwo159 string) (Service159Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id159},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service159Data{}, err
	}
	var service159Data Service159Data
	exists, err := res.One(ctx, &service159Data)
	if err != nil {
		return Service159Data{}, err
	}
	if exists {
		return service159Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	service159Data = Service159Data{
		ID:   id159,
		Data: data159,
	}
	if err := coll.InsertOne(ctx, service159Data); err != nil {
		return Service159Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	service159Data = Service159Data{
		ID:   id159,
		DataTwo: datatwo159,
	}
	if err := coll.InsertOne(ctx, service159Data); err != nil {
		return Service159Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service160.Method160(ctx, id159, data159, datatwo159); err != nil {
		return Service159Data{}, err
	}

	return service159Data, nil
}

func (s *Service159Impl) MethodOther159(ctx context.Context, id159 string, data159 string, datatwo159 string) (Service159Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id159},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service159Data{}, err
	}
	var service159Data Service159Data
	exists, err := res.One(ctx, &service159Data)
	if err != nil {
		return Service159Data{}, err
	}
	if exists {
		return service159Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	service159Data = Service159Data{
		ID:   id159,
		DataOther: data159,
	}
	if err := coll.InsertOne(ctx, service159Data); err != nil {
		return Service159Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	service159Data = Service159Data{
		ID:   id159,
		DataOtherTwo: datatwo159,
	}
	if err := coll.InsertOne(ctx, service159Data); err != nil {
		return Service159Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service160.MethodOther160(ctx, id159, data159, datatwo159); err != nil {
		return Service159Data{}, err
	}

	return service159Data, nil
}

func (s *Service159Impl) MethodOtherOther159(ctx context.Context, id159 string, data159 string, datatwo159 string) (Service159Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id159},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service159Data{}, err
	}
	var service159Data Service159Data
	exists, err := res.One(ctx, &service159Data)
	if err != nil {
		return Service159Data{}, err
	}
	if exists {
		return service159Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	service159Data = Service159Data{
		ID:   id159,
		DataOtherOther: data159,
	}
	if err := coll.InsertOne(ctx, service159Data); err != nil {
		return Service159Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service159DB.GetCollection(ctx, "service159_db", "service159_data")
	if err != nil {
		return Service159Data{}, err
	}
	service159Data = Service159Data{
		ID:   id159,
		DataOtherOtherTwo: datatwo159,
	}
	if err := coll.InsertOne(ctx, service159Data); err != nil {
		return Service159Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service160.MethodOtherOther160(ctx, id159, data159, datatwo159); err != nil {
		return Service159Data{}, err
	}

	return service159Data, nil
}
