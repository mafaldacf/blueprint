// Code generated by gen_workflow.go
package large_scale_app

import (
	"context"

	"github.com/blueprint-uservices/blueprint/runtime/core/backend"
	"go.mongodb.org/mongo-driver/bson"
)

type Service448Data struct {
	ID   string `bson:"id"`
	Data string `bson:"data"`
	DataTwo string `bson:"datatwo"`
	DataOther string `bson:"data_other"`
	DataOtherTwo string `bson:"datatwo_other"`
	DataOtherOther string `bson:"data_other_other"`
	DataOtherOtherTwo string `bson:"datatwo_other_other"`
}

type Service448 interface {
	Method448(ctx context.Context, id string, data string, datatwo string) (Service448Data, error)
	MethodOther448(ctx context.Context, id string, data string, datatwo string) (Service448Data, error)
	MethodOtherOther448(ctx context.Context, id string, data string, datatwo string) (Service448Data, error)
}

type Service448Impl struct {
	service448DB backend.NoSQLDatabase
	service449 Service449
}

func NewService448Impl(ctx context.Context, service448DB backend.NoSQLDatabase, service449 Service449) (Service448, error) {
	return &Service448Impl{
		service448DB: service448DB,
		service449: service449,
	}, nil
}

func (s *Service448Impl) Method448(ctx context.Context, id448 string, data448 string, datatwo448 string) (Service448Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id448},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service448Data{}, err
	}
	var service448Data Service448Data
	exists, err := res.One(ctx, &service448Data)
	if err != nil {
		return Service448Data{}, err
	}
	if exists {
		return service448Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	service448Data = Service448Data{
		ID:   id448,
		Data: data448,
	}
	if err := coll.InsertOne(ctx, service448Data); err != nil {
		return Service448Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	service448Data = Service448Data{
		ID:   id448,
		DataTwo: datatwo448,
	}
	if err := coll.InsertOne(ctx, service448Data); err != nil {
		return Service448Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service449.Method449(ctx, id448, data448, datatwo448); err != nil {
		return Service448Data{}, err
	}

	return service448Data, nil
}

func (s *Service448Impl) MethodOther448(ctx context.Context, id448 string, data448 string, datatwo448 string) (Service448Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id448},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service448Data{}, err
	}
	var service448Data Service448Data
	exists, err := res.One(ctx, &service448Data)
	if err != nil {
		return Service448Data{}, err
	}
	if exists {
		return service448Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	service448Data = Service448Data{
		ID:   id448,
		DataOther: data448,
	}
	if err := coll.InsertOne(ctx, service448Data); err != nil {
		return Service448Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	service448Data = Service448Data{
		ID:   id448,
		DataOtherTwo: datatwo448,
	}
	if err := coll.InsertOne(ctx, service448Data); err != nil {
		return Service448Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service449.MethodOther449(ctx, id448, data448, datatwo448); err != nil {
		return Service448Data{}, err
	}

	return service448Data, nil
}

func (s *Service448Impl) MethodOtherOther448(ctx context.Context, id448 string, data448 string, datatwo448 string) (Service448Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id448},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service448Data{}, err
	}
	var service448Data Service448Data
	exists, err := res.One(ctx, &service448Data)
	if err != nil {
		return Service448Data{}, err
	}
	if exists {
		return service448Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	service448Data = Service448Data{
		ID:   id448,
		DataOtherOther: data448,
	}
	if err := coll.InsertOne(ctx, service448Data); err != nil {
		return Service448Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service448DB.GetCollection(ctx, "service448_db", "service448_data")
	if err != nil {
		return Service448Data{}, err
	}
	service448Data = Service448Data{
		ID:   id448,
		DataOtherOtherTwo: datatwo448,
	}
	if err := coll.InsertOne(ctx, service448Data); err != nil {
		return Service448Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service449.MethodOtherOther449(ctx, id448, data448, datatwo448); err != nil {
		return Service448Data{}, err
	}

	return service448Data, nil
}
