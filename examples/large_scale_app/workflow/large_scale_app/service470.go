// Code generated by gen_workflow.go
package large_scale_app

import (
	"context"

	"github.com/blueprint-uservices/blueprint/runtime/core/backend"
	"go.mongodb.org/mongo-driver/bson"
)

type Service470Data struct {
	ID   string `bson:"id"`
	Data string `bson:"data"`
	DataTwo string `bson:"datatwo"`
	DataOther string `bson:"data_other"`
	DataOtherTwo string `bson:"datatwo_other"`
	DataOtherOther string `bson:"data_other_other"`
	DataOtherOtherTwo string `bson:"datatwo_other_other"`
}

type Service470 interface {
	Method470(ctx context.Context, id string, data string, datatwo string) (Service470Data, error)
	MethodOther470(ctx context.Context, id string, data string, datatwo string) (Service470Data, error)
	MethodOtherOther470(ctx context.Context, id string, data string, datatwo string) (Service470Data, error)
}

type Service470Impl struct {
	service470DB backend.NoSQLDatabase
	service471 Service471
}

func NewService470Impl(ctx context.Context, service470DB backend.NoSQLDatabase, service471 Service471) (Service470, error) {
	return &Service470Impl{
		service470DB: service470DB,
		service471: service471,
	}, nil
}

func (s *Service470Impl) Method470(ctx context.Context, id470 string, data470 string, datatwo470 string) (Service470Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id470},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service470Data{}, err
	}
	var service470Data Service470Data
	exists, err := res.One(ctx, &service470Data)
	if err != nil {
		return Service470Data{}, err
	}
	if exists {
		return service470Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	service470Data = Service470Data{
		ID:   id470,
		Data: data470,
	}
	if err := coll.InsertOne(ctx, service470Data); err != nil {
		return Service470Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	service470Data = Service470Data{
		ID:   id470,
		DataTwo: datatwo470,
	}
	if err := coll.InsertOne(ctx, service470Data); err != nil {
		return Service470Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service471.Method471(ctx, id470, data470, datatwo470); err != nil {
		return Service470Data{}, err
	}

	return service470Data, nil
}

func (s *Service470Impl) MethodOther470(ctx context.Context, id470 string, data470 string, datatwo470 string) (Service470Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id470},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service470Data{}, err
	}
	var service470Data Service470Data
	exists, err := res.One(ctx, &service470Data)
	if err != nil {
		return Service470Data{}, err
	}
	if exists {
		return service470Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	service470Data = Service470Data{
		ID:   id470,
		DataOther: data470,
	}
	if err := coll.InsertOne(ctx, service470Data); err != nil {
		return Service470Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	service470Data = Service470Data{
		ID:   id470,
		DataOtherTwo: datatwo470,
	}
	if err := coll.InsertOne(ctx, service470Data); err != nil {
		return Service470Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service471.MethodOther471(ctx, id470, data470, datatwo470); err != nil {
		return Service470Data{}, err
	}

	return service470Data, nil
}

func (s *Service470Impl) MethodOtherOther470(ctx context.Context, id470 string, data470 string, datatwo470 string) (Service470Data, error) {
	// ----------------------- READ -----------------------
	coll, err := s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	query := bson.D{
		{Key: "id", Value: id470},
	}
	res, err := coll.FindOne(ctx, query)
	if err != nil {
		return Service470Data{}, err
	}
	var service470Data Service470Data
	exists, err := res.One(ctx, &service470Data)
	if err != nil {
		return Service470Data{}, err
	}
	if exists {
		return service470Data, nil
	}

	// ----------------------- WRITE -----------------------
	coll, err = s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	service470Data = Service470Data{
		ID:   id470,
		DataOtherOther: data470,
	}
	if err := coll.InsertOne(ctx, service470Data); err != nil {
		return Service470Data{}, err
	}

	// ----------------------- WRITE v2 -----------------------
	coll, err = s.service470DB.GetCollection(ctx, "service470_db", "service470_data")
	if err != nil {
		return Service470Data{}, err
	}
	service470Data = Service470Data{
		ID:   id470,
		DataOtherOtherTwo: datatwo470,
	}
	if err := coll.InsertOne(ctx, service470Data); err != nil {
		return Service470Data{}, err
	}

	// call the next service in the chain
	if _, err := s.service471.MethodOtherOther471(ctx, id470, data470, datatwo470); err != nil {
		return Service470Data{}, err
	}

	return service470Data, nil
}
